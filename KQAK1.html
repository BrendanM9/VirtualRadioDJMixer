<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link rel="icon" type="image/x-icon" href="https://dehayf5mhw1h7.cloudfront.net/wp-content/uploads/sites/1950/2020/10/12160146/station-150x150.png">
        <title>KQAK Program Log</title>
        <!--<script type="module" src="KQAK.js"></script>-->
    </head>
    <body>
        <style>
            table {
              font-family: arial, sans-serif;
              border-collapse: collapse;
              width: 100%;
            }
            
            td, th {
              /*border: 1px solid #dddddd;*/
              text-align: left;
              padding: 4px;
            }
            .column{
                width: 20%;
                float: left;
            }
            /*.column0{
                
            }*/
            #column1{
                width: 40%;
            }
            #column2{
                width:20%;
            }
            #column3{
                width: 10%;
            }
            #column4{
                width: 10%;
            }
            #topOfHour{
                color:green;
            }
            /*tr :nth-child(even) {
              /*background-color: #dddddd;*
            }*/
            #TopOfHourText{
                font-size: 50px;
                color:green;
            }
            .resync{
                color: blue;
            }
            .spotBlock{
                color: purple;
            }
            .vt {
                color: red;
            }
            .img {
                color: orange;
            }
            .resyncChecks{
                padding:5px;
            }
        </style>
        <div id="timebox">
            <script src="https://code.jquery.com/jquery-latest.js"></script>
        <!--<table id="tracklist">
            <thead>Program Log</thead>
            <tr>
                <td>Time:</td>
                <!--<td>Year:</td>--
                <td>Song Title:</td>
                <td>Band/Artist:</td>
                <td>Song Length:</td>
            </tr>
            <tr>
                <td id="TopOfHour">XX:00</td>
                <!--<td>N/A</td>--
                <td id="TopOfHourText">Top of the Hour</td>
                <td>KQAK</td>
                <td>:20</td>
            </tr>
        </table>-->
        <div id="log">
            <div id="column0" class="column"></div>
            <div id="column1" class="column"></div>
            <div id="column2" class="column"></div>
            <div id="column3" class="column"></div>
            <div id="column4" class="column"></div>
        </div>
        <button id="print1">Print Tracklist</button>
    <script type="module">
        /*for(var a=0; a <= 200; a++){
            var newRow = document.createElement("tr")
            newRow.id = "R "+a;
            var newTime = document.createElement("td")
            newTime.id= "Time "+ a;
            var newName = document.createElement("td")
            newName.id= "Name "+ a;
            var newBand = document.createElement("td")
            newBand.id= "Band "+ a;
            var newLength = document.createElement("td")
            newLength.id= "Length "+ a;
            document.getElementById("tracklist").appendChild(newRow)
            document.getElementById("R "+a).appendChild(newTime)
            document.getElementById("R "+a).appendChild(newName)
            document.getElementById("R "+a).appendChild(newBand)
            document.getElementById("R "+a).appendChild(newLength)
            //document.getElementById("Time "+a).innerHTML = "yes";
        }*/
        /*const data1 = require('./lib.json');
        console.log("data1 \n", data1);
        document.getElementById("Song1").innerHTML = "data1[1].song"

    import data from './lib.json' assert { type: 'json' };
console.log(data);
*/        
        /*fetch('./lib.json')
        .then(response => {
            return(response.json());
        })
        .then(data => console.log(data));*/
        /*import data from "./kqakLib.json" assert { type: 'json' };
        console.log(data);*/
        //var lib = data.library[0].title;
        //console.log("Lib: "+lib)
        function repeatCheckSong(thisSong, songList, thisChoice1){
            //console.log(thisSong)
            //console.log(songList)
            //console.log(thisChoice1);
            //console.log(songList.length)
            for(var s = 0; s <= songList.length-1; s++){
                //console.log(s)
                //console.log(songList[s])
                //console.log(thisSong === songList[s].title)
                if(thisSong === songList[s].title){
                    if(thisSong === "Empty Spot Block"){
                        
                    } else if (thisSong === "Voice Track"){
                        
                    } else if (thisSong === "WX Donut"){
                        
                    } else if (thisSong === "Top Of The Hour Ramp"){
                        
                    } else if (thisSong === "DCE Rewind"){
                        
                    } else if (thisSong === "16 After MCO AD"){
                        
                    } else if (thisSong === "Contest Promo"){
                        
                    } else if (thisSong === "PSA Donut"){
                        
                    } else if (thisSong === "KQAK Legal ID HD 01"){
                        
                    } else if (thisSong === "Station Promo"){
                        
                    } else if (thisSong === "KQAK Legal ID HD 02"){
                        
                    } else {
                        console.log("REPEAT:"+thisSong);
                        thisChoice1 += 1 
                    }
                    
                } else {
                    //thisChoice1 = thisChoice1
                }
            }
            console.log(thisChoice1)
            return thisChoice1
        }
        function formatList(list, rows1){
                //console.log(list, rows1)
            var thisOrder = []
            var thisResyncList = []
            var thisTitleList = []
            //console.log(rows1.length)
            for(var i = 0;i <= rows1.length-1; i++){
                //var AAA = list.bmLive[0].aaa[0]
                //console.log("hello")
                var thisBlock = rows1[i].block
                var thisResync = rows1[i].resync
                var thisBlockAlphabet = null;
                if(thisBlock === "topOfHour"){
                    thisBlockAlphabet = list.library[0].topOfHour
                } else if(thisBlock === "80s"){
                    thisBlockAlphabet = list.library[0].a80s
                } else if(thisBlock === "70s"){
                    thisBlockAlphabet = list.library[0].a70s
                } else if(thisBlock === "90s"){
                    thisBlockAlphabet = list.library[0].a90s
                } else if(thisBlock === "specialty"){
                    thisBlockAlphabet = list.library[0].specialty
                } else if(thisBlock === "summer"){
                    thisBlockAlphabet = list.library[0].summer
                } else if(thisBlock === "wx"){
                    thisBlockAlphabet = list.library[0].wx
                } else if(thisBlock === "psa"){
                    thisBlockAlphabet = list.library[0].psa
                } else if(thisBlock === "legalID"){
                    thisBlockAlphabet = list.library[0].legalID
                } else if(thisBlock === "spotBlock"){
                    thisBlockAlphabet = list.library[0].spotBlock
                } else if(thisBlock === "disco"){
                    thisBlockAlphabet = list.library[0].disco
                } else if(thisBlock === "mco"){
                    thisBlockAlphabet = list.library[0].mco
                } else if(thisBlock === "dce"){
                    thisBlockAlphabet = list.library[0].dce
                } else if(thisBlock === "contest"){
                    thisBlockAlphabet = list.library[0].contest
                } else if(thisBlock === "station"){
                    thisBlockAlphabet = list.library[0].station
                } else if(thisBlock === "vt"){
                    thisBlockAlphabet = list.library[0].vt
                } /*else if(thisBlock === "016"){
                    thisBlockAlphabet = list.bmLive[0].abg
                } else if(thisBlock === "017"){
                    thisBlockAlphabet = list.bmLive[0].abh
                } else if(thisBlock === "020"){
                    thisBlockAlphabet = list.bmLive[0].aca
                } else if(thisBlock === "021"){
                    thisBlockAlphabet = list.bmLive[0].acb
                } else if(thisBlock === "022"){
                    thisBlockAlphabet = list.bmLive[0].acc
                } else if(thisBlock === "104"){
                    thisBlockAlphabet = list.bmLive[0].aae
                } else if(thisBlock === "106"){
                    thisBlockAlphabet = list.bmLive[0].aag
                }*/
                //it doesn't like the 000 format.
                //console.log(thisBlock)
                //console.log(thisBlockAlphabet)
                //thisBlockAlphabet = toString(thisBlockAlphabet)
                //console.log(list.bmLive[0].AAA[0])
                //console.log(list)
                //console.log(list.library)
                //console.log(list.library[0])
                //console.log(list.library[0].thisBlock)
                //console.log(list.library[0].topOfHour)
                var thisLength = thisBlockAlphabet.length
                //console.log(thisLength)
                var thisChoice = Math.floor(Math.random()*thisLength)
                //console.log(thisChoice)
                //console.log(list.bmLive[0].aaa[0])
                //console.log(thisOrder)
                //console.log(thisBlock[0])
                if(i > 0){
                    thisChoice = repeatCheckSong(thisBlockAlphabet[thisChoice].title, thisOrder, thisChoice);
                    if(thisBlockAlphabet[thisChoice].title in thisTitleList){
                        console.log("help")
                        thisChoice = repeatCheckSong(thisBlockAlphabet[thisChoice].title, thisOrder, thisChoice);
                    }
                }
                thisOrder.push(thisBlockAlphabet[thisChoice])
                thisTitleList.push(thisBlockAlphabet[thisChoice].title);
                thisResyncList.push(thisResync)
            }
            console.log(thisOrder)
            var clockH = 3;
            var clockM = 0;
            var clockS = 0
            var thisMinute
            var thisSecond
            for(var j = 0; j<=thisOrder.length-1; j++){
                var thisClock = document.createElement("p")
                thisClock.classList.add("clock")
                thisMinute = clockM
                thisSecond = clockS
                if(parseFloat(thisSecond) >= 60){
                    thisSecond -= 60;
                    thisMinute += 1
                    clockS -= 60
                    clockM += 1
                }
                if(parseFloat(thisMinute) >= 60){
                    thisMinute -= 60;
                    clockH += 1
                    clockM -= 60
                }
                if(thisMinute <= 9){
                    thisMinute = "0"+thisMinute
                }
                if(thisSecond <= 9){
                    thisSecond = "0"+thisSecond
                }
                thisClock.textContent = clockH + ":" + thisMinute + "." + thisSecond
                var thisArtist = document.createElement("p")
                thisArtist.classList.add("artist")
                thisArtist.id="thisId"
                //console.log(thisOrder[j]);
                //console.log(thisOrder[j].band);
                if(thisOrder[j].band === ""){
                    thisArtist.innerHTML = "<br>"
                } else {
                    thisArtist.textContent = thisOrder[j].band
                }
                var thisTitle = document.createElement("p")
                thisTitle.classList.add("title")
                thisTitle.textContent = thisOrder[j].title
                if(thisTitle.textContent === "Top Of The Hour Ramp"){
                    thisTitle.id = "topOfHour"
                } else if(thisTitle.textContent === "Empty Spot Block"){
                    thisTitle.classList.add("spotBlock")
                } else if(thisTitle.textContent === "Voice Track"){
                    thisTitle.classList.add("vt")
                } else if(thisTitle.textContent === "WX Donut"){
                    thisTitle.classList.add("vt")
                } else if(thisTitle.textContent === "PSA Donut"){
                    thisTitle.classList.add("vt")
                } else if(thisTitle.textContent === "DCE Rewind"){
                    thisTitle.classList.add("img")
                } else if(thisTitle.textContent === "Contest Promo"){
                    thisTitle.classList.add("img")
                } else if(thisTitle.textContent === "16 After MCO AD"){
                    thisTitle.classList.add("img")
                } else if(thisTitle.textContent === "Station Promo"){
                    thisTitle.classList.add("img")
                }
                var thisTime = document.createElement("p")
                thisTime.classList.add("time")
                var seconds
                if(thisOrder[j].seconds <= 9){
                    seconds = "0"+thisOrder[j].seconds
                } else {
                    seconds = thisOrder[j].seconds
                }
                thisTime.textContent = thisOrder[j].minutes+":"+seconds
                //console.log(thisResyncList[j])
                if(thisResyncList[j] !== "true"){
                    clockM = clockM + thisOrder[j].minutes
                    clockS = clockS + thisOrder[j].seconds
                } else {
                    thisClock.textContent = "ReSync";
                    thisClock.classList.add("resync")
                    thisTitle.classList.add("resync")
                    thisArtist.classList.add("resync")
                    thisTime.classList.add("resync")
                }
                var thisDiv = document.createElement("div")
                //thisDiv.innerHTML = 
                //var song = thisArtist. + thisTitle.ATTRIBUTE_NODE + thisTime.ATTRIBUTE_NODE
                //thisDiv.appendChild(song)
                //document.body.appendChild(thisDiv)
                var thisResyncCheck = document.createElement("input")
                thisResyncCheck.type = "checkbox"
                thisResyncCheck.value = "resync"+j
                thisResyncCheck.classList.add("resyncChecks");
                thisResyncCheck.addEventListener('change', e => {
                    if(e.target.checked){
                        console.log("checked");
                    }
                })
                var thisBr = document.createElement("br")
                document.getElementById("column0").appendChild(thisClock)
                document.getElementById("column1").appendChild(thisTitle)
                document.getElementById("column2").appendChild(thisArtist)
                document.getElementById("column3").appendChild(thisTime)
                //document.getElementById("column4").appendChild(thisResyncCheck)
                //document.getElementById("column4").appendChild(thisBr);
            }
            }
            function parseProgramPlan(plan){
                var programPlanTxt = programPlan/*.toString()*/
            console.log(programPlan)
            console.log(programPlanTxt)
            programPlanTxt = plan.kqak
            //var rows = programPlanTxt.split(',\n')
            //console.log(rows)
            $.getJSON("static/kqakLib.json", function(data){
                var libraryJson = data
                formatList(libraryJson, programPlanTxt)
            })
            //console.log(libraryJson)
            
            
            }
            var programPlan = null
            $.getJSON("static/programPlanKQAK.json", function(data){
                programPlan = data
                console.log(programPlan)
                parseProgramPlan(data)
            })
            
            //while(programPlan === null){
                console.log("waiting...")
        var list = document.getElementById("log")
        document.getElementById("print1").addEventListener("click", function(){
            console.log("print");
            print(list);
        });
    </script>
    </body>
</html>
